<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="">
<meta name="author" content="odsp">
<title>vuejs-pagination-demo</title>
<script type="text/javascript">
	var _ctx = '', EL = EL || {}, FN = FN || {}, GV = GV || {}, VM = VM || {}, URLS = URLS || {};
</script>
<script src="/s/json2/json2.js"></script>
<link rel="stylesheet" href="/s/select2/4.0.0/css/select2.min.css" />
<link rel="stylesheet" href="pagination.css" />
</head>
<body>

	<div style="margin-left: 10px;">
		<div style="margin-top: 10px;"></div>

		<select id="site" style="width: 300px;">

		</select>

		<hr>

		<div id="vue-grid">
			<table class="data-grid" cellpadding="0" cellspacing="0">
				<thead>
					<tr>
						<td>&nbsp;</td>
						<td>名称</td>
						<td>备注</td>
						<td>状态</td>
						<td>操作</td>
					</tr>
				</thead>
				<tbody>
					<tr v-for="record in records">
						<td><input data-sign="id" type="checkbox" v-bind:value="record.id" /></td>
						<td>{{record.name}}</td>
						<td>{{record.remark}}</td>
						<td>
							<div v-if="record.state===0">未发布</div>
							<div v-else-if="record.state===1">已发布</div>
							<div v-else>未知</div>
						</td>
						<td>
							<div v-if="record.state===0">
								<a class="x-link" v-on:click="publish(record.id)">发布</a>
							</div>
							<div v-else-if="record.state===1"></div>
							<div v-else></div>
						</td>
					</tr>
				</tbody>
			</table>

			<ul class="data-grid-page">
				<li v-if="hasPrevious"><a v-on:click.stop="gotoPage(currentPage-1)">上一页</a></li>
				<li v-for="index in indexs"><a v-on:click.stop="gotoPage(index)" v-bind:class="{'active':currentPage==index}">{{index}}</a></li>
				<li><span>第 {{currentPage}} 页，共 {{totalPages}} 页</span></li>
				<li v-if="hasNext"><a v-on:click.stop="gotoPage(currentPage+1)">下一页</a></li>
			</ul>
		</div>

		<div>
			<button id="batch-publish" type="button">发布</button>
		</div>

	</div>


	<script src="/s/jquery/1.11.1/jquery.min.js"></script>
	<script src="/s/jquery/patch/jquery-patch.js"></script>
	<script src="/s/select2/4.0.0/js/select2.min.js"></script>
	<script src="/s/vue/2.3.3/vue.min"></script>
	<script src="pagination.js"></script>

	<script type="text/javascript">
		$(function() {

			URLS.findSites = _ctx + '/sites/find.do';
			URLS.pagedQuery = _ctx + '/article-publish/paged-query.do';

			VM.grid = __.pagination({
				el : '#vue-grid',
				url : URLS.pagedQuery,
				methods : {
					publish : function(id) {
						alert(id);
					}
				}
			});

			FN.query = function() {
				var filters = {};
				filters.siteId = EL.site.val();
				VM.grid.load(filters);
			};

			$.post(URLS.findSites).done(function(records) {
				var html = '';
				$.each(records, function(i, record) {
					html += '<option value="' + $.encodeHTML(record.id) + '" >' + $.encodeHTML(record.name) + '</option>';
				});
				EL.site.html(html).select2('val', $.isEmpty(records) ? '' : records[0].id);

				FN.query();
			});

			$('#batch-publish').click(function() {
				var ids = [];
				$('#vue-grid [data-sign="id"]:checked').each(function() {
					ids.push(this.value);
				});
				if ($.isEmpty(ids)) {
					alert('Please select the articles to be published');
				} else {
					FN.post(ids);
				}
			});

		});
	</script>
</body>
</html>